<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>RumP2P Debug</title>
        <script src="dist/index.web.js"></script>
        <script src="wasm_exec.js"></script>
        <script>

(async () => {

    let chainConfig = {
        rumPeerId : {
            id: '12D3KooWNvSZnPi3RrhrTwEY4LuuBeB6K6facKUCJcyWG1aoDd2p',
            privKey: 'CAESYHyCgD+3HtEHm6kzPO6fuwP+BAr/PxfJKlvAOWhc/IqAwrZjCNn0jz93sSl81cP6R6x/g+iVYmR5Wxmn4ZtzJFnCtmMI2fSPP3exKXzVw/pHrH+D6JViZHlbGafhm3MkWQ==',
            pubKey: 'CAESIMK2YwjZ9I8/d7EpfNXD+kesf4PolWJkeVsZp+GbcyRZ'
        },
        rumWssPort : 7020,
        // global.chainConfig.rumBootstrap = [
        //     '/ip4/127.0.0.1/tcp/7030/ws/p2p/12D3KooWLV3w42LqUb9MWE7oTzG7vwaFjPw9GvDqmsuDif5chTn9'
        // ];
    };

    const topic = 'dad4a07a-80ce-4b32-8b9c-3f69642ca5c0';
    const node = await bistrot.rump2p.getNode(chainConfig);
    await bistrot.rump2p.subscribeToTopic(topic, (data) => {
        console.log('[RUMP2P] Received pubsub msg:', data);
    });

    // enable this session if you want to test direct dial
    // do {
    //     console.log('try to connect...');
        try {
            console.log(`[RUMP2P] Testing ping:`);
            const time = await bistrot.rump2p.ping(
                '/ip4/127.0.0.1/tcp/7002/ws/p2p/16Uiu2HAmP5DUiQihxuCtUsC6Li3WLFX3nsnq9jV38aLJHUqei6bA',
            );
            console.log(`[RUMP2P] Ping success within ${time} Î¼s.`);

            console.log(`[RUMP2P] Testing dial:`);
            const connection = await bistrot.rump2p.dial(
                '/ip4/127.0.0.1/tcp/7002/ws/p2p/16Uiu2HAmP5DUiQihxuCtUsC6Li3WLFX3nsnq9jV38aLJHUqei6bA',
            );
            console.log(`[RUMP2P] Dial success:`, connection);
        } catch (e) { console.log(e); }
    //     await bistrot.utilitas.timeout(1000 * 10);
    // } while (true);


    const go = new Go();
    WebAssembly.instantiateStreaming(fetch("gotest/main.wasm"), go.importObject).then((result) => {
        go.run(result.instance);
    })


})();

        </script>
    </head>

    <body>
        <div>
            OK!
        </div>
    </body>

</html>
